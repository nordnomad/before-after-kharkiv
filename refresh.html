<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Харьков в 1942 и сейчас</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
            integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
            crossorigin=""></script>
    <link rel="stylesheet" type="text/css" href="css/refresh.css"/>
    <script type="text/javascript" src="js/refresh.js"></script>

    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>

    <script type="text/javascript" src="js/before-after.js"></script>

    <script type="text/javascript" src="js/L.Map.Sync.js"></script>
<!--    TODO change to own font-->
    <link href="https://data.tagesspiegel.de/fonts/icomoon/standard.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="css/L.Icon.Pulse.css" type='text/css'/>
    <script src="js/L.Icon.Pulse.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.68.0/dist/L.Control.Locate.min.css" />

    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.68.0/dist/L.Control.Locate.min.js" charset="utf-8"></script>

    <link rel="stylesheet" type="text/css" href="css/leaflet.social.css"/>
    <script type='text/javascript' src="js/leaflet.social.js"></script>
</head>
<body>

<div id="container" class="show-intro">
    <div id="intro">
        <h1>Харьков</h1>
        <p>в 1942 и сегодня</p>
        <a href="javascript:;" id="button-explore">
            <i class="icon-map"></i> Исследовать
        </a>
        <a href="javascript:;" id="button-start">
            Пройти тур <i class="icon-tour"></i>
        </a>
    </div>
    <div id="map-base"></div>
    <div class="cd-panel from-left before">
        <header class="cd-panel-header">
            <h1 id="before-title">
                <!-- Title of selected point -->
            </h1>
            <a href="#0" class="cd-panel-close">Close</a>
        </header>

        <div class="content" id="content-1928">
            <div class="content-wrapper">
                <h2 id="content-title-1942"></h2>
                <div class="content-text">
                    <p id="content-description-1942"></p>
                </div>
                <div class="nav">
                    <div class="col2 col2left">
                        <a href="javascript:;" id="goto-back" class="goto goto-red">
                            <i class="icon-left"></i> Назад
                        </a>
                    </div>
                    <div class="col2 col2right">
                        <a href="javascript:;" id="goto-2015" class="goto goto-red">
                            2015
                            <i class="icon-right"></i>
                        </a>
                    </div>
                </div>
                <a href="javascript:;" class="goto goto-explore" title="Selbst erkunden">
                    <i class="icon-cross"></i>
                </a>
            </div>
        </div>
    </div>
    <div id="map-clip">
        <div id="map-clip-inner">
            <div id="map-overlay"></div>
            <div class="content" id="content-2015">
                <div class="content-wrapper">
                    <h2 id="content-title-2015"></h2>
                    <div class="content-text">
                        <p id="content-description-2015"></p>
                    </div>
                    <div class="nav">
                        <div class="col2 col2left">
                            <a href="javascript:;" id="goto-1942" class="goto goto-red">
                                <i class="icon-left"></i>
                                1942
                            </a>
                        </div>
                        <div class="col2 col2right">
                            <a href="javascript:;" id="goto-next" class="goto goto-red">
                                Вперед
                                <i class="icon-right"></i>
                            </a>
                        </div>
                    </div>
                    <a href="javascript:;" class="goto goto-explore" title="Selbst erkunden">
                        <i class="icon-cross"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div id="control-slider">
        <i class="icon-left"></i>
        <i class="icon-right"></i>
    </div>
</div>
<script>
    var center = [50.005720, 36.229192];
    var zoom = 16;
    var attributes = {
        attributionControl: false,
        inertia: true,
        maxZoom:16,
        minZoom:13,
        tileSize: 256,
        zoomControl:false
    }
    var before = L.map('map-base', attributes).setView(center, zoom);
	var after = L.map('map-overlay', attributes).setView(center, zoom);

    new L.Control.Zoom({ position: 'bottomright' }).addTo(after);
    new L.Control.Zoom({ position: 'bottomright' }).addTo(before);

    var locateOptions = {
		position: 'bottomright',
		icon : 'fa fa-location-arrow',
		drawCircle : false,
		drawMarker : false,
		strings: {
			title: "Show me where I am, yo!"
		},
		onLocationOutsideMapBounds : function(e) {
		    console.log('You are out of bounds!');
		    console.log(e)
		}
	}

    L.control.locate(locateOptions).addTo(after);
    L.control.locate(locateOptions).addTo(before);

	L.tileLayer('https://17200.selcdn.ru/AerialWWII/Z{z}/{y}/{x}.jpg').addTo(before);
	L.tileLayer('https://api.tiles.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoibm9yZG5vbWFkIiwiYSI6ImNrMjA3emg0cjEyc2YzY2w4MmltYWxqeGMifQ.jGJYfQpF8De6ZhhafArC1Q').addTo(after);

    var FullScreenControl = L.Control.extend({
        options: { position: 'bottomright' },
        onAdd: function (map) {
            var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control fullscreen-icon ');
            container.onclick = function(event){
                var element = document.body;
                if (event instanceof HTMLElement) {
                    element = event;
                }
                var isFullscreen = document.webkitIsFullScreen || document.mozFullScreen || false;
                element.requestFullScreen = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || function () { return false; };
                document.cancelFullScreen = document.cancelFullScreen || document.webkitCancelFullScreen || document.mozCancelFullScreen || function () { return false; };
                isFullscreen ? document.cancelFullScreen() : element.requestFullScreen();
            }
            return container;
        }
    });
    after.addControl(new FullScreenControl());
    before.addControl(new FullScreenControl());

    var TourControl = L.Control.extend({
        options: { position: 'bottomright' },
        onAdd: function (map) {
            var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control tour-icon');
            container.onclick = function(event){
                markerClickListener(geoJson[0], false);
            }
            return container;
        }
    });

    after.addControl(new TourControl());
    before.addControl(new TourControl());

    var options = {default_text: "Guess where I am", position: 'bottomright'};
    L.control.social(options).addTo(after);
    L.control.social(options).addTo(before);

    $('#container').beforeAfter();

    before.sync(after);
	after.sync(before);

    initContentPanel();

    loadGeoJson();

    function applySmallStyle() {
        if(isSmallWidth()) {
            $('#container').addClass('small');
        } else {
            $('#container').removeClass('small');
        }
    }

    applySmallStyle();

    window.onresize = function(event) {
        applySmallStyle();
    };

    $('#button-explore').on('click', function(e){
        $('#container').removeClass('show-intro');
        showMapControls();
    });
    $('#button-start').on('click', function(e){
        $('#container').removeClass('show-intro');
        markerClickListener(geoJson[0], false);
        showMapControls();
    });
</script>
</body>
</html>