<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Харьков в 1942 и сейчас</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
            integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
            crossorigin=""></script>

    <script src="https://unpkg.com/leaflet.tilelayer.fallback@1.0.4/dist/leaflet.tilelayer.fallback.js"></script>

    <link rel="stylesheet" type="text/css" href="css/refresh.css"/>
    <script type="text/javascript" src="js/refresh.js"></script>

    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>

    <script type="text/javascript" src="js/before-after.js"></script>

    <script type="text/javascript" src="js/L.Map.Sync.js"></script>

    <link rel="stylesheet" href="css/icomoon-style.css">
    <link rel="stylesheet" href="css/L.Icon.Pulse.css" type='text/css'/>
    <script src="js/L.Icon.Pulse.js"></script>

    <link rel="stylesheet" href="css/L.Control.Locate.css" />
    <script type="text/javascript" src="js/L.Control.Locate.js"></script>

    <script type="text/javascript" src="js/leaflet.social.js"></script>
    <script src="https://cdn.rawgit.com/nnattawat/flip/master/dist/jquery.flip.min.js"></script>
</head>
<body>

<div id="container" class="show-intro">
    <div id="intro">
        <h1>Харьков</h1>
        <p>в 1942 и сегодня</p>
        <a href="javascript:;" id="button-explore">
            <i class="icon-map-o"></i> Исследовать
        </a>
        <a href="javascript:;" id="button-start">
            Пройти тур <i class="icon-map-signs"></i>
        </a>
    </div>
    <div id="map-base"></div>
    <div class="cd-panel from-left before">
        <header class="cd-panel-header">
            <h1 id="before-title">
                <!-- Title of selected point -->
            </h1>
            <a href="#0" class="cd-panel-close">Close</a>
        </header>

        <div class="content" id="content-1928">
            <div class="content-wrapper">
                <h2 id="content-title-1942"></h2>
<!--                <div class="flip">-->
                <div class="content-image front">
<!--                    <img src="images/railway_station/railway_station_old.jpg">-->
                    <img id="content-img-1942" src="images/vokzal/vokzal_old.png">
                </div>
                <div class="content-text back">
                    <p id="content-description-1942"></p>
                </div>
<!--                </div>-->
                <div class="nav">
                    <div class="col3 col3left">
                        <a href="javascript:;" id="goto-back" class="goto goto-red">
                            <i class="icon-arrow-left2"></i> Назад
                        </a>
                    </div>
<!--                    <div class="col3 col3center">-->
<!--                        <a href="javascript:;" onclick="$('.flip').flip('toggle');" class="goto goto-red">-->
<!--                            Читать-->
<!--                        </a>-->
<!--                    </div>-->
                    <div class="col3 col3right">
                        <a href="javascript:;" id="goto-2015" class="goto goto-red">
                            2015
                            <i class="icon-arrow-right2"></i>
                        </a>
                    </div>
                </div>
                <a href="javascript:;" class="goto goto-explore" title="Selbst erkunden">
                    <i class="icon-cross"></i>
                </a>
            </div>
        </div>
    </div>
    <div id="map-clip">
        <div id="map-clip-inner">
            <div id="map-overlay"></div>
            <div class="content" id="content-2015">
                <div class="content-wrapper">
                    <h2 id="content-title-2015"></h2>
<!--                    <div class="flip">-->
                        <div class="content-image">
                            <img id="content-img-2015" src="images/vokzal/vokzal_new2.png">
                        </div>
                        <div class="content-text">
                            <p id="content-description-2015"></p>
                        </div>
<!--                    </div>-->
                    <div class="nav">
                        <div class="col2 col2left">
                            <a href="javascript:;" id="goto-1942" class="goto goto-red">
                                <i class="icon-arrow-left2"></i>
                                1942
                            </a>
                        </div>
                        <div class="col2 col2right">
                            <a href="javascript:;" id="goto-next" class="goto goto-red">
                                Вперед
                                <i class="icon-arrow-right2"></i>
                            </a>
                        </div>
                    </div>
                    <a href="javascript:;" class="goto goto-explore" title="Selbst erkunden">
                        <i class="icon-cross"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div id="control-slider">
        <i class="icon-arrow-left2"></i>
        <i class="icon-arrow-right2"></i>
    </div>
</div>
<script>
    function buildMap(id, layer) {
        var southWest = L.latLng(49.901689, 36.461400),
            northEast = L.latLng(50.115857,  36.019992),
            bounds = L.latLngBounds(southWest, northEast);

        var options = {
            attributionControl: false,
            inertia: true,
            maxZoom: 17,
            minZoom: 13,
            zoom: 16,
            tileSize: 256,
            zoomControl:false,
            center: {
                lat: 50.005720,
                lng: 36.229192
            },
            maxBounds: bounds
        };
        var map = L.map(id, options);
        new L.Control.Zoom({ position: 'bottomright' , zoomInText: '', zoomOutText: ''}).addTo(map)

        var locateOptions = {
            position: 'bottomright',
            icon : 'icon-location-arrow',
            iconLoading : 'spinner icon-spinner',
            iconElementTag: 'a',
            drawCircle : false,
            drawMarker : false,
            strings: {
                title: "Показать мое местоположение"
            },
            onLocationOutsideMapBounds : function(e) {
                console.log('You are out of bounds!');
                console.log(e)
            }
        }
        L.control.locate(locateOptions).addTo(map);

        var FullScreenControl = L.Control.extend({
            options: { position: 'bottomright' },
            onAdd: function (map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control fullscreen-icon ');
                L.DomUtil.create('a', 'icon-fullscreen', container);
                container.onclick = function(event){
                    var element = document.body;
                    if (event instanceof HTMLElement) {
                        element = event;
                    }
                    var isFullscreen = document.webkitIsFullScreen || document.mozFullScreen || false;
                    element.requestFullScreen = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || function () { return false; };
                    document.cancelFullScreen = document.cancelFullScreen || document.webkitCancelFullScreen || document.mozCancelFullScreen || function () { return false; };
                    isFullscreen ? document.cancelFullScreen() : element.requestFullScreen();
                }
                return container;
            }
        });
        map.addControl(new FullScreenControl());

        var TourControl = L.Control.extend({
            options: { position: 'bottomright' },
            onAdd: function (map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                L.DomUtil.create('a', 'icon-map-signs', container);
                container.onclick = function(event) {
                    markerClickListener(geoJson[0], false);
                }
                return container;
            }
        });
        map.addControl(new TourControl());

        var InfoControl = L.Control.extend({
            options: { position: 'bottomright' },
            onAdd: function (map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                L.DomUtil.create('a', 'icon-question', container);
                container.onclick = function(event) {
                    console.log('InfoControl')
                }
                return container;
            }
        });
        map.addControl(new InfoControl());

        var options = {default_text: "Как изменился Харьков с 1942го до сегодня", position: 'bottomright'};
        L.control.social(options).addTo(map);

        L.tileLayer(layer, {detectRetina : true}).addTo(map);

        return map;
    }

    var beforeLayerUrl = 'https://17200.selcdn.ru/AerialWWII/Z{z}/{y}/{x}.jpg';
	var before = buildMap('map-base', beforeLayerUrl);
    L.tileLayer.fallback(beforeLayerUrl, {minNativeZoom: 13}).addTo(before);

	var after = buildMap('map-overlay', 'https://api.tiles.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoibm9yZG5vbWFkIiwiYSI6ImNrMjA3emg0cjEyc2YzY2w4MmltYWxqeGMifQ.jGJYfQpF8De6ZhhafArC1Q');

    var container = document.querySelector('#container');
    var containerClasses = container.classList;

    $('#container').beforeAfter();

    before.sync(after);
	after.sync(before);

    initContentPanel();

    loadGeoJson();

    function applySmallStyle() {
        if(isSmallWidth()) {
            containerClasses.add('small');
        } else {
            containerClasses.remove('small');
        }
    }

    applySmallStyle();

    window.onresize = function(event) {
        applySmallStyle();
    };

    document.querySelector('#button-explore').addEventListener('click', function (event) {
        containerClasses.remove('show-intro');
        showMapControls();
    }, false);
    document.querySelector('#button-start').addEventListener('click', function (event) {
        containerClasses.remove('show-intro');
        markerClickListener(geoJson[0], false);
    }, false);

<!--    $(".flip").flip({-->
<!--      trigger: 'manual'-->
<!--    });-->
<!--    $(".flip").on('flip:done',function(e){-->
<!--        console.log(e);-->
<!--        var model = $(".flip").data("flip-model");-->
<!--        if(model.isFlipped) {-->
<!--            $('.content-image').hide();-->
<!--        } else {-->
<!--            $('.content-image').show();-->
<!--        }-->
<!--    });-->

    $('.leaflet-control-zoom-in').addClass('icon-plus');
    $('.leaflet-control-zoom-out').addClass('icon-minus');
</script>
</body>
</html>